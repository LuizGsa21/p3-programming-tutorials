{%- import 'macros.html' as m -%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,500' rel='stylesheet' type='text/css'>
    <!--Logo font-family-->
    <link href='http://fonts.googleapis.com/css?family=Cinzel' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:300' rel='stylesheet' type='text/css'>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    {%- block metaTags %}{% endblock -%}
    {%- block header %}{% endblock %}
</head>
<body id="{% block bodyID %}{% endblock %}">
{% set active_page = active_page|default('index') -%}
{# Main navbar #}
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Programming Tutorials</a>
        </div>
        <div class="collapse navbar-collapse navbar-main-collapse">
            <ul id="navbar-inner" class="nav navbar-nav navbar-right">
                {# Home page #}
                <li {{ m.active_class('index', active_page) }}><a href="{{ url_for('frontend.index') }}">Home</a></li>
                {# Dropdown containing all categories page #}
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                         {% for category in categories -%}
                             <li {{ m.active_class(category.name, active_page) -}}><a href="{{ url_for('frontend.articles', category=category.name) }}">{{ category.name }}</a></li>
                        {% endfor -%}
                        </ul>
                    </li>
                {% if current_user.is_authenticated() %}
                    <li {{ m.active_class('profile', active_page) }}><a href="{{ url_for('user.profile') }}">Profile</a></li>
                    <li><a href="{{ url_for('frontend.logout') }}">Logout</a></li>
                {% elif active_page != 'index' %}
                    <li><a href="{{ url_for('frontend.login') }}">Login</a></li>
                    <li><a href="{{ url_for('frontend.register') }}">Register</a></li>
                {% endif %}
            </ul>
        </div><!-- /.navbar-collapse -->
    </div>
</nav>

{%- block body %}{% endblock -%}

{# Footer #}
<footer class="footer footer-default footer-sticky animated fadeIn">
        <div class="container">
            <div class="row">
                <div class="col-xs-12 col-sm-4 col-md-4">
                    <h4 class="title">Navigation</h4>
                    {% for chunk in categories|chunks(5) %}
                        <ul class="nav footer-nav pull-left">
                            {% for category in chunk %}
                                <li><a href="#">{{ category }}</a></li>
                            {% endfor %}
                        </ul>
                    {% endfor %}
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4 valign">
                    <div class="quote">"Programming is a lifestyle."</div>
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4 col-lg-3 col-lg-offset-1">
                    <div class="stay-connected">
                        <h4 class="title">Stay Connected</h4>
                        <p class="text-justify-full">
                            {{ m.get_social_buttons([
                                {'google-plus':'https://plus.google.com/103499838655205368925/posts'},
                                {'twitter':'https://twitter.com/LArantesSa'},
                                {'github':'https://github.com/LuizGsa21'}]) }}
                        </p>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <div class="copyright text-center">Copyright &copy; All Rights Reserved</div>
                </div>
            </div>
        </div>
</footer>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="{{ url_for('static', filename='js/bowser.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery-plugins.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.form.js') }}"></script>
<script src="{{ url_for('static', filename='js/bootstrap.js') }}"></script>
<script src="{{ url_for('static', filename='js/app.js') }}"></script>
<!--[if lte IE 9 ]>
<script src="js/jquery.html5-placeholder-shim.js"></script>
<![endif]-->
<script>
    // Initialize app variables
    app.isLoggedIn = {% if current_user.is_authenticated() %}true{% else %}false{% endif %}
    app.csrfToken = '{{ csrf_token()|safe }}';
    app.client_id = '{{ 'GOOGLE_CLIENT_ID'|os_environ|safe }}.apps.googleusercontent.com';
    app.$navbar = $('#navbar-inner');
    app.dynamicLinks = {
        'Profile': '{{ url_for('user.profile')|safe }}',
        'Register': '{{ url_for('frontend.register')|safe }}',
        'Login': '{{ url_for('frontend.login')|safe }}',
        'Logout': '{{ url_for('frontend.logout')|safe }}'
    };
</script>

<script>
    function start() {
        gapi.load('auth2', function() {
            // Retrieve the singleton for the GoogleAuth library and set up the client.
            app.auth2 = gapi.auth2.init({
                // client_id <- notice the underscore. This is for Google Sign-In depend
                client_id: app.client_id,
                cookiepolicy: 'single_host_origin',
                fetch_basic_profile: false,
                scope: 'openid email'
            });
           var $form = $('#sign-registration-form');
           if ($form.length) {
               // add a listener to the googleplus button
               $form.find('.btn-square.azm-google-plus').on('click', function(e) {
                  app.auth2.grantOfflineAccess({redirect_uri: 'postmessage'})
                   .then(googleSignInCallback, googleSignInCallback);
               e.preventDefault();
           });
           }
        });
    }

    // callback invoked by `auth2.grantOfflineAccess()`
    function googleSignInCallback(authResult) {
        if (authResult['code']) {
            $.ajax({
              type: 'POST',
              url: '{{ url_for('oauth.google_authorized') }}' ,
              data: authResult['code'],
              contentType: 'application/octet-stream; charset=utf-8',
              processData: false,
              beforeSend: app.getCSRFHeader(), // csrf protection

              success: function(data) {
                // invoke onSuccessSignIn handler.
                onSuccessSignIn(data, 'google');
              },
              error: function(data) {
                // invoke onFailSignIn handler.
                onFailSignIn(data, 'google');
              }
            });
        } else {
            // invoke onFailSignIn handler.
            onFailSignIn(data, 'google');
        }
    }
    // Let the users know we don't care about IE8
    if (bowser.msie && bowser.version <= 8) {
        alert('It seems like you are using Internet Explorer '
            + bowser.version + '. If you care about the internet please update your web browser.');
    }
</script>
<script src="https://apis.google.com/js/api:client.js?onload=start" async defer></script>
{% block bodyPostfix %}{% endblock %}
</body>
</html>